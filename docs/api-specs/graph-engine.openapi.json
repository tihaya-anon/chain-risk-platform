{
    "openapi": "3.0.1",
    "info": {
        "title": "Graph Engine API",
        "description": "Address clustering and tag propagation service for Chain Risk Platform",
        "contact": {
            "name": "Chain Risk Team",
            "email": "chainrisk@example.com"
        },
        "license": {
            "name": "MIT License",
            "url": "https://opensource.org/licenses/MIT"
        },
        "version": "1.0.0"
    },
    "servers": [
        {
            "url": "/",
            "description": "Default Server"
        }
    ],
    "tags": [
        {
            "name": "Graph API",
            "description": "Address graph analysis and clustering operations"
        }
    ],
    "paths": {
        "/api/graph/sync": {
            "post": {
                "tags": [
                    "Graph API"
                ],
                "summary": "Trigger sync",
                "description": "Manually trigger data synchronization from PostgreSQL to Neo4j",
                "operationId": "triggerSync",
                "responses": {
                    "200": {
                        "description": "OK",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/SyncStatusResponse"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/api/graph/propagate": {
            "post": {
                "tags": [
                    "Graph API"
                ],
                "summary": "Propagate risk tags",
                "description": "Propagate risk scores and tags from high-risk addresses to neighbors",
                "operationId": "propagateTags",
                "responses": {
                    "200": {
                        "description": "OK",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/PropagationResultResponse"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/api/graph/propagate/{address}": {
            "post": {
                "tags": [
                    "Graph API"
                ],
                "summary": "Propagate from address",
                "description": "Propagate risk from a specific source address",
                "operationId": "propagateFromAddress",
                "parameters": [
                    {
                        "name": "address",
                        "in": "path",
                        "description": "Source address",
                        "required": true,
                        "schema": {
                            "type": "string"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "OK",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/PropagationResultResponse"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/api/graph/cluster/run": {
            "post": {
                "tags": [
                    "Graph API"
                ],
                "summary": "Run clustering algorithm",
                "description": "Trigger address clustering based on common input heuristic",
                "operationId": "runClustering",
                "responses": {
                    "200": {
                        "description": "OK",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/ClusteringResultResponse"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/api/graph/cluster/manual": {
            "post": {
                "tags": [
                    "Graph API"
                ],
                "summary": "Manually cluster addresses",
                "description": "Create a cluster from a list of addresses",
                "operationId": "manualCluster",
                "requestBody": {
                    "content": {
                        "application/json": {
                            "schema": {
                                "type": "array",
                                "items": {
                                    "type": "string"
                                }
                            }
                        }
                    },
                    "required": true
                },
                "responses": {
                    "200": {
                        "description": "OK",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/ClusteringResultResponse"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/api/graph/address/{address}/tags": {
            "get": {
                "tags": [
                    "Graph API"
                ],
                "summary": "Get address tags",
                "description": "Get all tags associated with an address",
                "operationId": "getAddressTags",
                "parameters": [
                    {
                        "name": "address",
                        "in": "path",
                        "description": "Blockchain address",
                        "required": true,
                        "schema": {
                            "type": "string"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "OK",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "type": "array",
                                    "items": {
                                        "type": "string"
                                    }
                                }
                            }
                        }
                    }
                }
            },
            "post": {
                "tags": [
                    "Graph API"
                ],
                "summary": "Add tags to address",
                "description": "Add one or more tags to an address (manual tagging)",
                "operationId": "addTags",
                "parameters": [
                    {
                        "name": "address",
                        "in": "path",
                        "description": "Blockchain address",
                        "required": true,
                        "schema": {
                            "type": "string"
                        }
                    }
                ],
                "requestBody": {
                    "content": {
                        "application/json": {
                            "schema": {
                                "$ref": "#/components/schemas/AddTagRequest"
                            }
                        }
                    },
                    "required": true
                },
                "responses": {
                    "200": {
                        "description": "OK",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/AddressInfoResponse"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/api/health": {
            "get": {
                "tags": [
                    "health-controller"
                ],
                "operationId": "health",
                "responses": {
                    "200": {
                        "description": "OK",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "type": "object",
                                    "additionalProperties": {
                                        "type": "object"
                                    }
                                }
                            }
                        }
                    }
                }
            }
        },
        "/api/health/ready": {
            "get": {
                "tags": [
                    "health-controller"
                ],
                "operationId": "ready",
                "responses": {
                    "200": {
                        "description": "OK",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "type": "object",
                                    "additionalProperties": {
                                        "type": "object"
                                    }
                                }
                            }
                        }
                    }
                }
            }
        },
        "/api/health/live": {
            "get": {
                "tags": [
                    "health-controller"
                ],
                "operationId": "live",
                "responses": {
                    "200": {
                        "description": "OK",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "type": "object",
                                    "additionalProperties": {
                                        "type": "object"
                                    }
                                }
                            }
                        }
                    }
                }
            }
        },
        "/api/graph/sync/status": {
            "get": {
                "tags": [
                    "Graph API"
                ],
                "summary": "Get sync status",
                "description": "Get current synchronization status between PostgreSQL and Neo4j",
                "operationId": "getSyncStatus",
                "responses": {
                    "200": {
                        "description": "OK",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/SyncStatusResponse"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/api/graph/search/tag/{tag}": {
            "get": {
                "tags": [
                    "Graph API"
                ],
                "summary": "Search by tag",
                "description": "Find addresses with a specific tag",
                "operationId": "searchByTag",
                "parameters": [
                    {
                        "name": "tag",
                        "in": "path",
                        "description": "Tag to search for",
                        "required": true,
                        "schema": {
                            "type": "string"
                        }
                    },
                    {
                        "name": "limit",
                        "in": "query",
                        "description": "Maximum results",
                        "required": false,
                        "schema": {
                            "maximum": 200,
                            "minimum": 1,
                            "type": "integer",
                            "format": "int32",
                            "default": 50
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "OK",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "type": "array",
                                    "items": {
                                        "$ref": "#/components/schemas/AddressInfoResponse"
                                    }
                                }
                            }
                        }
                    }
                }
            }
        },
        "/api/graph/search/high-risk": {
            "get": {
                "tags": [
                    "Graph API"
                ],
                "summary": "Get high-risk addresses",
                "description": "Find addresses with risk score above threshold",
                "operationId": "getHighRiskAddresses",
                "parameters": [
                    {
                        "name": "threshold",
                        "in": "query",
                        "description": "Risk score threshold (0.0 - 1.0)",
                        "required": false,
                        "schema": {
                            "maximum": 1,
                            "minimum": 0,
                            "type": "number",
                            "format": "double",
                            "default": 0.6
                        }
                    },
                    {
                        "name": "limit",
                        "in": "query",
                        "description": "Maximum results",
                        "required": false,
                        "schema": {
                            "maximum": 200,
                            "minimum": 1,
                            "type": "integer",
                            "format": "int32",
                            "default": 50
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "OK",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "type": "array",
                                    "items": {
                                        "$ref": "#/components/schemas/AddressInfoResponse"
                                    }
                                }
                            }
                        }
                    }
                }
            }
        },
        "/api/graph/path/{fromAddress}/{toAddress}": {
            "get": {
                "tags": [
                    "Graph API"
                ],
                "summary": "Find path between addresses",
                "description": "Find the shortest path of transfers between two addresses",
                "operationId": "findPath",
                "parameters": [
                    {
                        "name": "fromAddress",
                        "in": "path",
                        "description": "Source address",
                        "required": true,
                        "schema": {
                            "type": "string"
                        }
                    },
                    {
                        "name": "toAddress",
                        "in": "path",
                        "description": "Target address",
                        "required": true,
                        "schema": {
                            "type": "string"
                        }
                    },
                    {
                        "name": "maxDepth",
                        "in": "query",
                        "description": "Maximum path depth",
                        "required": false,
                        "schema": {
                            "maximum": 10,
                            "minimum": 1,
                            "type": "integer",
                            "format": "int32",
                            "default": 5
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "OK",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/PathResponse"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/api/graph/cluster/{clusterId}": {
            "get": {
                "tags": [
                    "Graph API"
                ],
                "summary": "Get cluster by ID",
                "description": "Get cluster information by cluster ID",
                "operationId": "getCluster",
                "parameters": [
                    {
                        "name": "clusterId",
                        "in": "path",
                        "description": "Cluster ID",
                        "required": true,
                        "schema": {
                            "type": "string"
                        }
                    }
                ],
                "responses": {
                    "404": {
                        "description": "Cluster not found",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/ClusterResponse"
                                }
                            }
                        }
                    },
                    "200": {
                        "description": "Cluster found",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/ClusterResponse"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/api/graph/address/{address}": {
            "get": {
                "tags": [
                    "Graph API"
                ],
                "summary": "Get address information",
                "description": "Get detailed information about an address including tags and risk score",
                "operationId": "getAddressInfo",
                "parameters": [
                    {
                        "name": "address",
                        "in": "path",
                        "description": "Blockchain address (0x-prefixed)",
                        "required": true,
                        "schema": {
                            "type": "string"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "Address found",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/AddressInfoResponse"
                                }
                            }
                        }
                    },
                    "404": {
                        "description": "Address not found",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/AddressInfoResponse"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/api/graph/address/{address}/neighbors": {
            "get": {
                "tags": [
                    "Graph API"
                ],
                "summary": "Get address neighbors",
                "description": "Get addresses that have transferred to/from this address",
                "operationId": "getNeighbors",
                "parameters": [
                    {
                        "name": "address",
                        "in": "path",
                        "description": "Blockchain address",
                        "required": true,
                        "schema": {
                            "type": "string"
                        }
                    },
                    {
                        "name": "depth",
                        "in": "query",
                        "description": "Search depth (1-3)",
                        "required": false,
                        "schema": {
                            "maximum": 3,
                            "minimum": 1,
                            "type": "integer",
                            "format": "int32",
                            "default": 1
                        }
                    },
                    {
                        "name": "limit",
                        "in": "query",
                        "description": "Maximum number of neighbors to return",
                        "required": false,
                        "schema": {
                            "maximum": 200,
                            "minimum": 1,
                            "type": "integer",
                            "format": "int32",
                            "default": 50
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "OK",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/AddressNeighborsResponse"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/api/graph/address/{address}/cluster": {
            "get": {
                "tags": [
                    "Graph API"
                ],
                "summary": "Get address cluster",
                "description": "Get the cluster this address belongs to",
                "operationId": "getAddressCluster",
                "parameters": [
                    {
                        "name": "address",
                        "in": "path",
                        "description": "Blockchain address",
                        "required": true,
                        "schema": {
                            "type": "string"
                        }
                    }
                ],
                "responses": {
                    "404": {
                        "description": "Address not in any cluster",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/ClusterResponse"
                                }
                            }
                        }
                    },
                    "200": {
                        "description": "Cluster found",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/ClusterResponse"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/api/graph/address/{address}/tags/{tag}": {
            "delete": {
                "tags": [
                    "Graph API"
                ],
                "summary": "Remove tag from address",
                "description": "Remove a specific tag from an address",
                "operationId": "removeTag",
                "parameters": [
                    {
                        "name": "address",
                        "in": "path",
                        "description": "Blockchain address",
                        "required": true,
                        "schema": {
                            "type": "string"
                        }
                    },
                    {
                        "name": "tag",
                        "in": "path",
                        "description": "Tag to remove",
                        "required": true,
                        "schema": {
                            "type": "string"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "OK"
                    }
                }
            }
        }
    },
    "components": {
        "schemas": {
            "SyncStatusResponse": {
                "type": "object",
                "properties": {
                    "status": {
                        "type": "string"
                    },
                    "lastSyncedBlock": {
                        "type": "integer",
                        "format": "int64"
                    },
                    "totalAddresses": {
                        "type": "integer",
                        "format": "int64"
                    },
                    "totalTransfers": {
                        "type": "integer",
                        "format": "int64"
                    },
                    "lastSyncTime": {
                        "type": "string",
                        "format": "date-time"
                    },
                    "nextSyncTime": {
                        "type": "string",
                        "format": "date-time"
                    },
                    "network": {
                        "type": "string"
                    },
                    "errorMessage": {
                        "type": "string"
                    }
                }
            },
            "PropagationResultResponse": {
                "type": "object",
                "properties": {
                    "status": {
                        "type": "string"
                    },
                    "addressesAffected": {
                        "type": "integer",
                        "format": "int32"
                    },
                    "tagsPropagated": {
                        "type": "integer",
                        "format": "int32"
                    },
                    "maxHops": {
                        "type": "integer",
                        "format": "int32"
                    },
                    "decayFactor": {
                        "type": "number",
                        "format": "double"
                    },
                    "durationMs": {
                        "type": "integer",
                        "format": "int64"
                    },
                    "startedAt": {
                        "type": "string",
                        "format": "date-time"
                    },
                    "completedAt": {
                        "type": "string",
                        "format": "date-time"
                    },
                    "errorMessage": {
                        "type": "string"
                    }
                }
            },
            "ClusteringResultResponse": {
                "type": "object",
                "properties": {
                    "status": {
                        "type": "string"
                    },
                    "clustersCreated": {
                        "type": "integer",
                        "format": "int32"
                    },
                    "addressesClustered": {
                        "type": "integer",
                        "format": "int32"
                    },
                    "durationMs": {
                        "type": "integer",
                        "format": "int64"
                    },
                    "startedAt": {
                        "type": "string",
                        "format": "date-time"
                    },
                    "completedAt": {
                        "type": "string",
                        "format": "date-time"
                    },
                    "errorMessage": {
                        "type": "string"
                    }
                }
            },
            "AddTagRequest": {
                "required": [
                    "tags"
                ],
                "type": "object",
                "properties": {
                    "tags": {
                        "type": "array",
                        "items": {
                            "type": "string"
                        }
                    },
                    "source": {
                        "type": "string"
                    },
                    "confidence": {
                        "type": "number",
                        "format": "double"
                    }
                }
            },
            "AddressInfoResponse": {
                "type": "object",
                "properties": {
                    "address": {
                        "type": "string"
                    },
                    "firstSeen": {
                        "type": "string",
                        "format": "date-time"
                    },
                    "lastSeen": {
                        "type": "string",
                        "format": "date-time"
                    },
                    "txCount": {
                        "type": "integer",
                        "format": "int64"
                    },
                    "riskScore": {
                        "type": "number",
                        "format": "double"
                    },
                    "tags": {
                        "type": "array",
                        "items": {
                            "type": "string"
                        }
                    },
                    "clusterId": {
                        "type": "string"
                    },
                    "network": {
                        "type": "string"
                    },
                    "incomingCount": {
                        "type": "integer",
                        "format": "int32"
                    },
                    "outgoingCount": {
                        "type": "integer",
                        "format": "int32"
                    }
                }
            },
            "PathNode": {
                "type": "object",
                "properties": {
                    "address": {
                        "type": "string"
                    },
                    "txHash": {
                        "type": "string"
                    },
                    "value": {
                        "type": "string"
                    },
                    "timestamp": {
                        "type": "string",
                        "format": "date-time"
                    },
                    "riskScore": {
                        "type": "number",
                        "format": "double"
                    },
                    "tags": {
                        "type": "array",
                        "items": {
                            "type": "string"
                        }
                    }
                }
            },
            "PathResponse": {
                "type": "object",
                "properties": {
                    "found": {
                        "type": "boolean"
                    },
                    "fromAddress": {
                        "type": "string"
                    },
                    "toAddress": {
                        "type": "string"
                    },
                    "pathLength": {
                        "type": "integer",
                        "format": "int32"
                    },
                    "maxDepth": {
                        "type": "integer",
                        "format": "int32"
                    },
                    "path": {
                        "type": "array",
                        "items": {
                            "$ref": "#/components/schemas/PathNode"
                        }
                    }
                }
            },
            "ClusterResponse": {
                "type": "object",
                "properties": {
                    "clusterId": {
                        "type": "string"
                    },
                    "size": {
                        "type": "integer",
                        "format": "int32"
                    },
                    "riskScore": {
                        "type": "number",
                        "format": "double"
                    },
                    "label": {
                        "type": "string"
                    },
                    "category": {
                        "type": "string"
                    },
                    "tags": {
                        "type": "array",
                        "items": {
                            "type": "string"
                        }
                    },
                    "addresses": {
                        "type": "array",
                        "items": {
                            "type": "string"
                        }
                    },
                    "createdAt": {
                        "type": "string",
                        "format": "date-time"
                    },
                    "updatedAt": {
                        "type": "string",
                        "format": "date-time"
                    },
                    "network": {
                        "type": "string"
                    }
                }
            },
            "AddressNeighborsResponse": {
                "type": "object",
                "properties": {
                    "address": {
                        "type": "string"
                    },
                    "neighbors": {
                        "type": "array",
                        "items": {
                            "$ref": "#/components/schemas/NeighborInfo"
                        }
                    },
                    "totalCount": {
                        "type": "integer",
                        "format": "int32"
                    },
                    "depth": {
                        "type": "integer",
                        "format": "int32"
                    }
                }
            },
            "NeighborInfo": {
                "type": "object",
                "properties": {
                    "address": {
                        "type": "string"
                    },
                    "direction": {
                        "type": "string"
                    },
                    "transferCount": {
                        "type": "integer",
                        "format": "int32"
                    },
                    "totalValue": {
                        "type": "string"
                    },
                    "lastTransfer": {
                        "type": "string",
                        "format": "date-time"
                    },
                    "riskScore": {
                        "type": "number",
                        "format": "double"
                    },
                    "tags": {
                        "type": "array",
                        "items": {
                            "type": "string"
                        }
                    }
                }
            }
        }
    }
}